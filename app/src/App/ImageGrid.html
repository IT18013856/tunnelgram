<div class="d-flex flex-wrap bg-secondary rounded" style="max-width: 450px;">
  {#each images as image (image.name)}
    <div class="d-flex justify-content-center align-items-center">
      {#await image.thumbnail}
        <LoadingIndicator width="{image.thumbnailWidth}px" height="{image.thumbnailHeight}px" />
      {:then thumbnail}
        <a href="javascript:void(0)" on:click="showBigImage(image)" style="font-size: 0;">
          <img src="data:{image.thumbnailType};base64,{thumbnail}" alt="{image.name}" title="{image.name}" width="{image.thumbnailWidth}" height="{image.thumbnailHeight}" />
        </a>
      {:catch e}
        <span class="badge badge-warning">error</span>
      {/await}
    </div>
  {/each}
</div>

{#if _showBigImage}
  <!-- TODO(hperrin): move this to outside the card so the z-index works -->
  <div ref:bigImageBox class="d-flex justify-content-center align-items-center bg-dark">
    {#await _promise}
      <LoadingIndicator width="50px" height="50px" />
    {:then data}
      <img src="data:{_image.dataType};base64,{data}" alt="{_image.name}" title="{_image.name}" width="{_image.dataWidth}" style="max-width: 90%; max-height: 90%; width: auto; height: auto;" />
    {:catch e}
      <span class="badge badge-warning">error</span>
    {/await}
    <button type="button" class="btn btn-lg btn-danger rounded-circle position-absolute" style="opacity: .8; right: 1vw; top: 1vw;" on:click="set({_showBigImage: false})">
      <i class="fas fa-times text-white"></i>
    </button>
  </div>
{/if}

<script>
  import LoadingIndicator from './LoadingIndicator.html';

  export default {
    data () {
      return {
        _showBigImage: false
      };
    },

    methods: {
      showBigImage (_image) {
        this.set({
          _showBigImage: true,
          _image,
          _promise: _image.data.promise()
        })
      }
    },

    components: {
      LoadingIndicator
    },

    helpers: {
      parseFloat
    }
  };
</script>

<style>
  ref:bigImageBox {
    position: fixed;
    left: 0;
    top: 0;
    z-index: 10000;
    width: 100vw;
    height: 100vh;
    overflow: auto;
  }
</style>
